---

# Tasks about plugin management

- name: 'Manage plugins installation'
  include: "{{ role_path }}/tasks/manage_plugins_installation.yml"
  when: "{{ jenkins_manage_plugin_install }}"


- name: 'Manage plugins upgrade'
  include: "{{ role_path }}/tasks/manage_plugins_upgrade.yml"
  when: "{{ jenkins_manage_plugin_upgrade }}"


- name: 'Enable plugins'
  become: True
  become_user: "{{ jenkins_etc_user }}"
  register: 'jenkins_tasks_enable_plugins'
  enable_jenkins_plugin:
    name: "{{ item.name }}"
    cli_path: '/var/lib/jenkins/jenkins-cli.jar'
    use_ssh_key: "{{ (jenkins_authentication_disabled is defined)
                        and (jenkins_authentication_disabled | skipped) }}"
  with_items: "{{ jenkins_plugins }}"


- name: 'Restart Jenkins once all plugins enabled'
  include: "{{ role_path }}/handlers/restart_and_waiting_jenkins.yml"
  when:
    - "{{Â jenkins_tasks_enable_plugins is defined }}"
    - "{{Â jenkins_tasks_enable_plugins.changed }}"
